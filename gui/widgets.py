# -*- coding: utf-8 -*-
"""

@author: Steinn Ymir Agustsson
"""
import sys
import qdarkstyle
import pyqtgraph as PG
from PyQt5 import QtWidgets, QtCore, QtGui
from stepscan.QT.ui_instrumentsMonitor import Ui_Ui_InstrumentsMonitor
from stepscan.QT.ui_plotArea import  Ui_Ui_PlotArea
from stepscan.QT.ui_scanMonitor import Ui_UI_ScanMonitor
from stepscan.QT.ui_setupTimescale import Ui_Ui_SetupTimeScale

class DockSetupTimeScale(QtWidgets.QDockWidget, QtWidgets.QWidget):
    def __init__(self):
        super(DockSetupTimeScale, self).__init__()

        self.ui = Ui_Ui_SetupTimeScale()
        self.ui.setupUi(self)


class DockScanMonitor(QtWidgets.QDockWidget, QtWidgets.QWidget):
    def __init__(self):
        super(DockScanMonitor, self).__init__()

        self.ui = Ui_UI_ScanMonitor()
        self.ui.setupUi(self)


class DockPlotArea(QtWidgets.QDockWidget, QtWidgets.QWidget):
    def __init__(self):
        super(DockPlotArea, self).__init__()

        self.ui = Ui_Ui_PlotArea()
        self.ui.setupUi(self)


class DockInstrumentMonitor(QtWidgets.QDockWidget, QtWidgets.QWidget):
    def __init__(self):
        super(DockInstrumentMonitor, self).__init__()

        self.ui = Ui_Ui_InstrumentsMonitor()
        self.ui.setupUi(self)


class TESTMainWidget(QtWidgets.QMainWindow):

    def __init__(self):
        super(TESTMainWidget, self).__init__()

        # self.setupUi(self)
        self.plotArea = DockPlotArea()
        self.instrumentMonitor = DockInstrumentMonitor()
        self.scanMonitor = DockScanMonitor()
        self.setupTimeScale = DockSetupTimeScale()

        layout = QtWidgets.QGridLayout()  # create a grid for subWidgets
        layout.setSpacing(10)
        self.setLayout(layout)


        layout.addWidget(self.plotArea, 0, 0)
        layout.addWidget(self.instrumentMonitor, 0, 3)
        layout.addWidget(self.scanMonitor, 2, 0)
        layout.addWidget(self.setupTimeScale, 2, 3)
        # self.setCentralWidget(self.centralWidget)
        # self.statusBar().showMessage('Message in statusbar.')

        self.setStyleSheet(qdarkstyle.load_stylesheet_pyqt5())
        PG.setConfigOption('background', 0.1)
        PG.setConfigOption('foreground', 0.7)
        PG.setConfigOptions(antialias=True)

        self.show()


def my_exception_hook(exctype, value, traceback):
    # Print the error and traceback
    print(exctype, value, traceback)
    # Call the normal Exception hook after
    sys._excepthook(exctype, value, traceback)
    sys.exit(1)

if __name__ == "__main__":
    # used to see errors generated by PyQt5 in pycharm:
    sys._excepthook = sys.excepthook
    # Set the exception hook to our wrapping function
    sys.excepthook = my_exception_hook

    app = QtCore.QCoreApplication.instance()
    if app is None:
        app = QtWidgets.QApplication(sys.argv)
    # Create handle prg for the Graphic Interface
    prg = TESTMainWidget()
    prg.show()

    try:
        app.exec_()
    except:
        print('app.exec_() failed: exiting')